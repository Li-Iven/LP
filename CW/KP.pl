sex('Vasilii_1 Ivenkov', 'M').
sex('Tatiana Rubina', 'F').
sex('Liubov Ivenkova', 'F').
sex('Aleksei Ivenkov', 'M').
sex('Valentina Ivenkova', 'F').
sex('Sergei Rubin', 'M').
sex('Liudmila Rubina', 'F').
sex('Iurii Rubin', 'M').
sex('Olga Samoilenko', 'F').
sex('Ivan Rubin', 'M').
sex('Anna Rubina', 'F').
sex('Ekaterina Rubina', 'F').
sex('Timofei Rubin', 'M').
sex('Kseniia Rubina', 'F').
sex('Irina Ivenkova', 'F').
sex('Evgenii Koryshev', 'M').
sex('Natalia Korysheva', 'F').
sex('Olga Ivenkova', 'F').
sex('Vasilii_2 Ivenkov', 'M').
sex('Vassa Ivenkova', 'F').
sex('Aleksei Badaev', 'M').
sex('Klavdiia Varfolomeeva', 'F').
sex('Margarita Badaeva', 'F').
sex('Timofei Varfolomeev', 'M').
sex('Aleksandr Badaev', 'M').
sex('Irina Rubina', 'F').
sex('Nikifor', 'M').
sex('Ivan Ivenkov', 'M').
sex('Dina Ivenkova', 'F').
sex('Vera Ivenkova', 'F').
sex('Igor Ivenkov', 'M').
sex('Zinaida Ivenkova', 'F').
sex('Larisa Ivenkova', 'F').
sex('Aleksei Pavlov', 'M').
sex('Aleksandr Pavlov', 'M').
sex('Uliana Pavlova', 'F').
sex('Nikolai_1', 'M').
sex('Nikolai_2', 'M').
sex('Polina Pavlova', 'F').
sex('Anna Pavlova', 'F').
sex('Angelina Pavlova', 'F').
sex('Ilia Ivenkov', 'M').
sex('Iuliia Ivenkova', 'F').
sex('Nadezhda', 'F').
sex('Igor', 'M').
sex('Liudmila', 'F').
sex('Vladimir', 'M').
sex('Olga', 'F').
sex('Oleg', 'M').
sex('Kirill', 'M').
sex('Aleksandr_2', 'M').
sex('Anastasiia Varfolomeeva', 'F').
sex('Mariia Varfolomeeva', 'F').
sex('Pelageia Varfolomeeva', 'F').
sex('Ekaterina Varfolomeeva', 'F').
sex('Daria Varfolomeeva', 'F').
sex('Nikolai Varfolomeev', 'M').
sex('Viktor Varfolomeev', 'M').
sex('Aleksandra Kostiukhina', 'F').
sex('Nefyod', 'M').
sex('Boris_2 Kostiukhin', 'M').
sex('Aleksandr Kostiukhin', 'M').
sex('Andrei Galinskii', 'M').
sex('Irina Galinskaia', 'F').
sex('Ivan Varfolomeev', 'M').
sex('Aleksandra Varfolomeeva', 'F').
sex('Aleksandr_1', 'M').
sex('Boris_1 Kostiukhin', 'M').
sex('Mariia', 'F').
sex('Elizaveta', 'F').
sex('Aleksandr_3', 'M').
sex('Nikolai Solokhin', 'M').
sex('Aleksei', 'M').
sex('Irina', 'F').
sex('Sergei', 'M').
parent('Vasilii_1 Ivenkov', 'Liubov Ivenkova').
parent('Tatiana Rubina', 'Liubov Ivenkova').
parent('Vasilii_1 Ivenkov', 'Olga Ivenkova').
parent('Tatiana Rubina', 'Olga Ivenkova').
parent('Aleksei Ivenkov', 'Vasilii_1 Ivenkov').
parent('Valentina Ivenkova', 'Vasilii_1 Ivenkov').
parent('Aleksei Ivenkov', 'Irina Ivenkova').
parent('Valentina Ivenkova', 'Irina Ivenkova').
parent('Sergei Rubin', 'Tatiana Rubina').
parent('Liudmila Rubina', 'Tatiana Rubina').
parent('Sergei Rubin', 'Iurii Rubin').
parent('Liudmila Rubina', 'Iurii Rubin').
parent('Iurii Rubin', 'Ivan Rubin').
parent('Olga Samoilenko', 'Ivan Rubin').
parent('Iurii Rubin', 'Anna Rubina').
parent('Olga Samoilenko', 'Anna Rubina').
parent('Iurii Rubin', 'Ekaterina Rubina').
parent('Olga Samoilenko', 'Ekaterina Rubina').
parent('Iurii Rubin', 'Timofei Rubin').
parent('Olga Samoilenko', 'Timofei Rubin').
parent('Iurii Rubin', 'Kseniia Rubina').
parent('Olga Samoilenko', 'Kseniia Rubina').
parent('Evgenii Koryshev', 'Natalia Korysheva').
parent('Irina Ivenkova', 'Natalia Korysheva').
parent('Vasilii_2 Ivenkov', 'Aleksei Ivenkov').
parent('Vassa Ivenkova', 'Aleksei Ivenkov').
parent('Vasilii_2 Ivenkov', 'Ivan Ivenkov').
parent('Vassa Ivenkova', 'Ivan Ivenkov').
parent('Vasilii_2 Ivenkov', 'Dina Ivenkova').
parent('Vassa Ivenkova', 'Dina Ivenkova').
parent('Vasilii_2 Ivenkov', 'Vera Ivenkova').
parent('Vassa Ivenkova', 'Vera Ivenkova').
parent('Aleksei Badaev', 'Liudmila Rubina').
parent('Klavdiia Varfolomeeva', 'Liudmila Rubina').
parent('Aleksei Badaev', 'Margarita Badaeva').
parent('Klavdiia Varfolomeeva', 'Margarita Badaeva').
parent('Timofei Varfolomeev', 'Ekaterina Varfolomeeva').
parent('Timofei Varfolomeev', 'Daria Varfolomeeva').
parent('Timofei Varfolomeev', 'Nikolai Varfolomeev').
parent('Timofei Varfolomeev', 'Viktor Varfolomeev').
parent('Timofei Varfolomeev', 'Aleksandra Varfolomeeva').
parent('Timofei Varfolomeev', 'Klavdiia Varfolomeeva').
parent('Timofei Varfolomeev', 'Anastasiia Varfolomeeva').
parent('Timofei Varfolomeev', 'Mariia Varfolomeeva').
parent('Timofei Varfolomeev', 'Pelageia Varfolomeeva').
parent('Aleksandr Badaev', 'Aleksei Badaev').
parent('Irina Rubina', 'Sergei Rubin').
parent('Nikifor', 'Irina Rubina').
parent('Ivan Ivenkov', 'Igor Ivenkov').
parent('Zinaida Ivenkova', 'Igor Ivenkov').
parent('Ivan Ivenkov', 'Larisa Ivenkova').
parent('Zinaida Ivenkova', 'Larisa Ivenkova').
parent('Aleksandr Pavlov', 'Aleksei Pavlov').
parent('Larisa Ivenkova', 'Aleksei Pavlov').
parent('Aleksandr Pavlov', 'Uliana Pavlova').
parent('Larisa Ivenkova', 'Uliana Pavlova').
parent('Nikolai_2', 'Nikolai_1').
parent('Uliana Pavlova', 'Nikolai_1').
parent('Aleksei Pavlov', 'Polina Pavlova').
parent('Anna Pavlova', 'Polina Pavlova').
parent('Aleksei Pavlov', 'Angelina Pavlova').
parent('Anna Pavlova', 'Angelina Pavlova').
parent('Igor Ivenkov', 'Ilia Ivenkov').
parent('Igor Ivenkov', 'Iuliia Ivenkova').
parent('Iuliia Ivenkova', 'Nadezhda').
parent('Iuliia Ivenkova', 'Igor').
parent('Vladimir', 'Liudmila').
parent('Dina Ivenkova', 'Liudmila').
parent('Oleg', 'Olga').
parent('Vera Ivenkova', 'Olga').
parent('Kirill', 'Mariia').
parent('Olga', 'Mariia').
parent('Kirill', 'Elizaveta').
parent('Olga', 'Elizaveta').
parent('Kirill', 'Aleksandr_3').
parent('Olga', 'Aleksandr_3').
parent('Aleksandr_2', 'Oleg').
parent('Boris_2 Kostiukhin', 'Valentina Ivenkova').
parent('Aleksandra Kostiukhina', 'Valentina Ivenkova').
parent('Boris_2 Kostiukhin', 'Boris_1 Kostiukhin').
parent('Aleksandra Kostiukhina', 'Boris_1 Kostiukhin').
parent('Nefyod', 'Aleksandra Kostiukhina').
parent('Aleksandr Kostiukhin', 'Boris_2 Kostiukhin').
parent('Anastasiia Varfolomeeva', 'Irina Galinskaia').
parent('Anastasiia Varfolomeeva', 'Andrei Galinskii').
parent('Ivan Varfolomeev', 'Timofei Varfolomeev').
parent('Aleksandra Varfolomeeva', 'Aleksandr_1').
parent('Nikolai Solokhin', 'Aleksei').
parent('Margarita Badaeva', 'Aleksei').
parent('Aleksei', 'Sergei').
parent('Irina', 'Sergei').

brother(X,Y) :- parent(A,X), parent(A,Y), sex(X,'M').
cousin(X,Y) :- parent(A,X), parent(B,Y), parent(C,A), parent(C,B), sex(X,'M'), not(brother(X,Y)).

rodnye(P,S):-
    parent(P1,P),
    parent(P1,S),
    P \= S.

type(husband, H,W):-
    parent(H,C),
    parent(W,C),
    H \= W,
    sex(H,'M').

type(wife, W,H):-
    parent(H,C),
    parent(W,C),
    H \= W,
    sex(W,'F').

type(brother, B, Y):-
    rodnye(B, Y),
    sex(B,'M').

type(sister, S, Y):-
    rodnye(S, Y),
    sex(S,'F').

type(father, F,C):-
    parent(F,C),
    sex(F,'M').

type(mother, M,C):-
    parent(M,C),
    sex(M,'F').

type(parent, P,C):-
    parent(P,C).

type(son, C,P):-
    parent(P,C),
    sex(C,'M').

type(daughter, C,P):-
    parent(P,C),
    sex(C,'F').

type(child, C, P):-
    parent(P,C).

types(X):-
    member(X, [father, mother, sister, brother, son, daughter, husband, wife]).

relative(X, Y, Res):-
    search_bdth(X, Y, Res1),
    transform(Res1, Res).

transform([_],[]):-!. 
transform([X,Y|T],Res):-
    type(R,X,Y),
    Res = [R|Tmp],
    transform([Y|T],Tmp),!.

prolong([X|T],[Y,X|T]):-
    move(X,Y),
    not(member(Y,[X|T])).

move(X,Y):-
    type(_,X,Y).

search_bdth(X,Y,P):-
    bdth([[X]],Y,L),
    reverse(L,P).

bdth([[X|T]|_],X,[X|T]).
bdth([P|QI],X,R):-
    findall(Z,prolong(P,Z),T),
    append(QI,T,Q0),
    bdth(Q0,X,R).

bdth([_|T],Y,L):-
    bdth(T,Y,L).

%  Ест.-язык. инт

ask_relative(X, Y, Res):-
    types(Res), !,
    type(Res, X, Y).

question_word(X):-
    member(X, [how, who, "How", "Who"]).

much_many(X):-
    member(X, [much, many]).

mn_chisla(X):-
    member(X, [sisters, brothers, sons, daughters]).
mn_chislo(sister, sisters).
mn_chislo(brother, brothers).
mn_chislo(son, sons).
mn_chislo(daughter, daughters).

help_word(X):-
    member(X, [do, does]).

have_has(X):-
    member(X, [have, has]).

is(X):-
    member(X,[is]).

particle(X):-
    member(X, ["'s"]).

question_mark(X):-
    member(X, ['?']).

his_her(X):-
    member(X, [his, her, he, she]).

%how many brothers does *name* have ?
ask_question(List):-
    List = [A,B,C,D,E,F,H],
    question_word(A),
    much_many(B),
    mn_chisla(C),
    help_word(D),
    (sex(E,'M');sex(E,'F')),
    nb_setval(lastName,E),
    have_has(F),
    question_mark(H),

    mn_chislo(C1,C),
    setof(X,ask_relative(X,E,C1),T),
    length(T,Res),!,
    write(E),
    write(" have "),
    ((Res =:= 1,write(Res),write(" "),write( C1));(not(Res =:= 1),write(Res),write(" "),write( C))),!.

%how many brothers does he have ?
ask_question(List):-
    List = [A,B,C1,D,E1,F,H],
    question_word(A),
    much_many(B),
    mn_chisla(C1),
    help_word(D),
    his_her(E1),
    nb_getval(lastName,E),
    have_has(F),
    question_mark(H),

    mn_chislo(C,C1),
    setof(X,ask_relative(X,E,C),T),
    length(T,Res),
    write(E),
    write(" have "),
    ((Res =:= 1,write(Res),write(" "),write(C));(not(Res =:= 1),write(Res),write(" "),write(C1))),!.

% who is *name* brother?
ask_question(List):-
    List = [A,B,C,D,E,F],
    question_word(A),
    is(B),
    (sex(C,'M');sex(C,'F')),
    nb_setval(lastName,C),
    particle(D),
    types(E),
    question_mark(F), !,
    type(E,Res,C),
    write(Res),write(" is "), write(C),write("'s "),write(E).

% who is her brother
ask_question(List):-
    List = [A,B,C1,D,E],
    question_word(A),
    is(B),
    his_her(C1),
    nb_getval(lastName,C),
    types(D),
    question_mark(E),!,
    type(D,Res,C),
    write(Res),write(" is "), write(C),write("'s "),write(D).

% is *name* *name* s son?
ask_question(List):-
    List = [A,B,C,D,E,F],
    nb_setval(lastName,C),
    is(A),
    (sex(B,'M');sex(B,'F')),
    (sex(C,'M');sex(C,'F')),
    particle(D),
    types(E),
    question_mark(F),
    type(E,B,C),!.

% is *name* his son?
ask_question(List):-
    List = [A,B,C1,D,E],
    is(A),
    (sex(B,'M');sex(B,'F')),
    his_her(C1),
    types(D),
    question_mark(E),

    nb_getval(lastName,C),
    type(D,B,C),!.